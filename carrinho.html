<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Carrinho - Alpha's Burgues</title>
<style>
body {
  background-color: #fff5ec;
  font-family: Arial, sans-serif;
  margin: 0;
  padding: 20px;
}

.carrinho-container {
  max-width: 700px;
  margin: 0 auto;
  background-color: #fff0e0;
  border: 2px solid #ffc285;
  border-radius: 10px;
  padding: 20px;
  box-shadow: 0 4px 15px rgba(255, 194, 133, 0.3);
}

.header-carrinho {
  text-align: center;
  color: #e65c00;
  margin-bottom: 30px;
  border-bottom: 2px solid #ffc285;
  padding-bottom: 15px;
}

.item-carrinho {
  background-color: #fff5ec;
  border: 1px solid #ffc285;
  border-radius: 8px;
  padding: 15px;
  margin: 10px 0;
  display: flex;
  justify-content: space-between;
  align-items: center;
  transition: transform 0.2s ease;
}

.item-carrinho:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 8px rgba(255, 194, 133, 0.4);
}

.item-info {
  flex: 1;
}

.item-nome {
  font-weight: bold;
  color: #e65c00;
  font-size: 16px;
}

.item-extras {
  color: #666;
  font-size: 14px;
  margin: 5px 0;
}

.item-detalhes {
  color: #555;
  font-size: 14px;
}

.item-acoes {
  display: flex;
  flex-direction: column;
  align-items: flex-end;
  gap: 10px;
}

.item-preco {
  font-weight: bold;
  color: #e65c00;
  font-size: 18px;
}

.controle-quantidade {
  display: flex;
  align-items: center;
  gap: 5px;
}

.btn-quantidade {
  background-color: #ffc285;
  border: none;
  width: 30px;
  height: 30px;
  border-radius: 50%;
  cursor: pointer;
  font-size: 16px;
  font-weight: bold;
  transition: background-color 0.3s;
}

.btn-quantidade:hover {
  background-color: #ffb95c;
}

.quantidade-display {
  background-color: white;
  border: 1px solid #ffc285;
  border-radius: 5px;
  padding: 5px 10px;
  min-width: 30px;
  text-align: center;
  font-weight: bold;
}

.total-container {
  background: linear-gradient(45deg, #ffcf96, #ffc285);
  padding: 20px;
  border-radius: 10px;
  text-align: center;
  margin: 30px 0;
  border: 2px solid #ffb95c;
}

.total-text {
  font-size: 24px;
  font-weight: bold;
  color: #8B4513;
  margin: 0;
}

.botao {
  background-color: #ffc285;
  border: none;
  padding: 12px 20px;
  border-radius: 8px;
  cursor: pointer;
  font-size: 16px;
  margin: 5px;
  text-decoration: none;
  display: inline-block;
  color: black;
  font-weight: bold;
  transition: all 0.3s ease;
}

.botao:hover {
  background-color: #ffb95c;
  transform: translateY(-2px);
}

.botao-finalizar {
  background: linear-gradient(45deg, #e65c00, #ff6b00);
  color: white;
  font-weight: bold;
  width: 100%;
  padding: 15px;
  font-size: 18px;
  margin-top: 10px;
}

.botao-finalizar:hover {
  background: linear-gradient(45deg, #d63384, #e65c00);
}

.botao-remover {
  background-color: #dc3545;
  color: white;
  padding: 8px 12px;
  border: none;
  border-radius: 5px;
  cursor: pointer;
  font-size: 12px;
  transition: background-color 0.3s;
}

.botao-remover:hover {
  background-color: #c82333;
}

.carrinho-vazio {
  text-align: center;
  color: #666;
  font-style: italic;
  padding: 60px 20px;
  background-color: #fff5ec;
  border-radius: 10px;
  border: 2px dashed #ffc285;
}

.carrinho-vazio h3 {
  color: #e65c00;
  margin-bottom: 15px;
}

.resumo-pedido {
  background-color: #fff5ec;
  border: 1px solid #ffc285;
  border-radius: 8px;
  padding: 15px;
  margin: 20px 0;
}

.resumo-item {
  display: flex;
  justify-content: space-between;
  margin: 8px 0;
  padding: 5px 0;
  border-bottom: 1px dotted #ffc285;
}

.resumo-item:last-child {
  border-bottom: none;
  font-weight: bold;
  font-size: 18px;
  color: #e65c00;
}

@media (max-width: 768px) {
  .item-carrinho {
    flex-direction: column;
    text-align: center;
    gap: 15px;
  }
  
  .item-acoes {
    width: 100%;
    flex-direction: row;
    justify-content: space-between;
    align-items: center;
  }
  
  .carrinho-container {
    margin: 10px;
    padding: 15px;
  }
}

.loading {
  display: none;
  text-align: center;
  padding: 20px;
  color: #666;
}

.success-message {
  background-color: #d4edda;
  color: #155724;
  padding: 12px;
  border-radius: 8px;
  margin: 10px 0;
  text-align: center;
  display: none;
}
</style>
</head>
<body>

<div class="carrinho-container">
  <div class="header-carrinho">
    <h1>üõí Seu Carrinho</h1>
    <p>Revise seus itens antes de finalizar o pedido</p>
  </div>
  
  <div class="success-message" id="success-message">
    Item adicionado com sucesso! üéâ
  </div>
  
  <div id="itens-carrinho">
    <!-- Itens ser√£o carregados aqui -->
  </div>

  <div id="carrinho-vazio" class="carrinho-vazio" style="display: none;">
    <h3>üçî Seu carrinho est√° vazio!</h3>
    <p>Adicione alguns produtos deliciosos do nosso menu.</p>
    <a href="labub√¥nicos.html" class="botao">Ver Menu</a>
  </div>

  <div id="resumo-container" style="display: none;">
    <div class="resumo-pedido">
      <h3 style="color: #e65c00; margin-top: 0;">üìã Resumo do Pedido</h3>
      <div id="resumo-itens"></div>
    </div>

    <div class="total-container">
      <p class="total-text">Total: R$ <span id="total-pedido">0,00</span></p>
    </div>
  </div>

  <div style="text-align: center; margin-top: 20px;">
    <a href="labub√¥nicos.html" class="botao">‚Üê Voltar ao Menu</a>
    <button onclick="limparCarrinho()" class="botao" id="btn-limpar" style="display: none; background-color: #dc3545; color: white;">
      üóëÔ∏è Limpar Carrinho
    </button>
    <button onclick="finalizarPedido()" class="botao botao-finalizar" id="btn-finalizar" style="display: none;">
      üìû Finalizar via WhatsApp
    </button>
  </div>
  
  <div class="loading" id="loading">
    Processando pedido... ‚è≥
  </div>
</div>

<script>
// Sistema de carrinho
class CarrinhoManager {
  constructor() {
    this.carrinho = [];
    this.init();
  }

  init() {
    this.carregarCarrinho();
    this.processarURL();
    this.atualizarInterface();
  }

  // Processa par√¢metros da URL para adicionar item
  processarURL() {
    const urlParams = new URLSearchParams(window.location.search);
    
    if (urlParams.get('produto')) {
      const produto = urlParams.get('produto');
      const preco = parseFloat(urlParams.get('preco')) || 0;
      
      // Busca quantidade nos diferentes campos poss√≠veis
      const quantidade = parseInt(
        urlParams.get('quantidade_virginia') || 
        urlParams.get('quantidade_labubu') || 
        urlParams.get('quantidade_boobie') || 
        urlParams.get('quantidade_morango') || 
        urlParams.get('quantidade_refri') ||
        urlParams.get('quantidade_waffles') ||
        urlParams.get('quantidade_milkshake') ||
        urlParams.get('quantidade_duopist') || 1
      );
      
      // Captura extras/varia√ß√µes
      let extras = [];
      if (urlParams.get('tipo_refri')) {
        extras.push(`Tipo: ${urlParams.get('tipo_refri')}`);
      }
      if (urlParams.get('tamanho_milk')) {
        extras.push(`Tamanho: ${urlParams.get('tamanho_milk')}`);
      }
      if (urlParams.get('extra_milk') && urlParams.get('extra_milk') !== 'Sem extra') {
        extras.push(`Extra: ${urlParams.get('extra_milk')}`);
      }
      
      this.adicionarItem(produto, preco, quantidade, extras.join(', '));
      this.mostrarMensagemSucesso();
      
      // Limpa a URL para evitar re-adi√ß√£o
      window.history.replaceState({}, document.title, window.location.pathname);
    }
  }

  // Adiciona item ao carrinho
  adicionarItem(produto, preco, quantidade = 1, extras = '') {
    // Verifica se j√° existe um item id√™ntico
    const itemExistente = this.carrinho.find(item => 
      item.produto === produto && item.extras === extras
    );

    if (itemExistente) {
      itemExistente.quantidade += quantidade;
    } else {
      const novoItem = {
        id: Date.now() + Math.random(), // ID √∫nico
        produto: produto,
        preco: parseFloat(preco),
        quantidade: parseInt(quantidade),
        extras: extras
      };
      this.carrinho.push(novoItem);
    }

    this.salvarCarrinho();
    this.atualizarInterface();
  }

  // Remove item do carrinho
  removerItem(id) {
    this.carrinho = this.carrinho.filter(item => item.id !== id);
    this.salvarCarrinho();
    this.atualizarInterface();
  }

  // Atualiza quantidade de um item
  atualizarQuantidade(id, novaQuantidade) {
    const item = this.carrinho.find(item => item.id === id);
    if (item && novaQuantidade > 0) {
      item.quantidade = parseInt(novaQuantidade);
      this.salvarCarrinho();
      this.atualizarInterface();
    } else if (novaQuantidade <= 0) {
      this.removerItem(id);
    }
  }

  // Limpa todo o carrinho
  limparCarrinho() {
    if (confirm('Tem certeza que deseja limpar todo o carrinho?')) {
      this.carrinho = [];
      this.salvarCarrinho();
      this.atualizarInterface();
    }
  }

  // Salva carrinho no sessionStorage (funciona para a sess√£o atual)
  salvarCarrinho() {
    try {
      sessionStorage.setItem('alphas_carrinho', JSON.stringify(this.carrinho));
    } catch (e) {
      // Fallback se sessionStorage n√£o estiver dispon√≠vel
      window.alphas_carrinho_backup = this.carrinho;
    }
  }

  // Carrega carrinho do sessionStorage
  carregarCarrinho() {
    try {
      const carrinhoSalvo = sessionStorage.getItem('alphas_carrinho');
      if (carrinhoSalvo) {
        this.carrinho = JSON.parse(carrinhoSalvo);
      }
    } catch (e) {
      // Fallback
      this.carrinho = window.alphas_carrinho_backup || [];
    }
  }

  // Atualiza toda a interface do carrinho
  atualizarInterface() {
    const container = document.getElementById('itens-carrinho');
    const carrinhoVazio = document.getElementById('carrinho-vazio');
    const resumoContainer = document.getElementById('resumo-container');
    const totalElement = document.getElementById('total-pedido');
    const btnFinalizar = document.getElementById('btn-finalizar');
    const btnLimpar = document.getElementById('btn-limpar');
    
    if (this.carrinho.length === 0) {
      container.innerHTML = '';
      carrinhoVazio.style.display = 'block';
      resumoContainer.style.display = 'none';
      btnFinalizar.style.display = 'none';
      btnLimpar.style.display = 'none';
      return;
    }
    
    carrinhoVazio.style.display = 'none';
    resumoContainer.style.display = 'block';
    btnFinalizar.style.display = 'block';
    btnLimpar.style.display = 'inline-block';
    
    this.renderizarItens();
    this.renderizarResumo();
  }

  // Renderiza os itens do carrinho
  renderizarItens() {
    const container = document.getElementById('itens-carrinho');
    let html = '';
    
    this.carrinho.forEach(item => {
      const subtotal = item.preco * item.quantidade;
      
      html += `
        <div class="item-carrinho">
          <div class="item-info">
            <div class="item-nome">${item.produto}</div>
            ${item.extras ? `<div class="item-extras">${item.extras}</div>` : ''}
            <div class="item-detalhes">Pre√ßo unit√°rio: R$ ${item.preco.toFixed(2)}</div>
          </div>
          <div class="item-acoes">
            <div class="item-preco">R$ ${subtotal.toFixed(2)}</div>
            <div class="controle-quantidade">
              <button class="btn-quantidade" onclick="carrinho.atualizarQuantidade(${item.id}, ${item.quantidade - 1})">-</button>
              <div class="quantidade-display">${item.quantidade}</div>
              <button class="btn-quantidade" onclick="carrinho.atualizarQuantidade(${item.id}, ${item.quantidade + 1})">+</button>
            </div>
            <button class="botao-remover" onclick="carrinho.removerItem(${item.id})">Remover</button>
          </div>
        </div>
      `;
    });
    
    container.innerHTML = html;
  }

  // Renderiza o resumo do pedido
  renderizarResumo() {
    const resumoContainer = document.getElementById('resumo-itens');
    const totalElement = document.getElementById('total-pedido');
    
    let html = '';
    let total = 0;
    let totalItens = 0;
    
    this.carrinho.forEach(item => {
      const subtotal = item.preco * item.quantidade;
      total += subtotal;
      totalItens += item.quantidade;
      
      html += `
        <div class="resumo-item">
          <span>${item.quantidade}x ${item.produto}</span>
          <span>R$ ${subtotal.toFixed(2)}</span>
        </div>
      `;
    });
    
    html += `
      <div class="resumo-item">
        <span>Total (${totalItens} ${totalItens === 1 ? 'item' : 'itens'})</span>
        <span>R$ ${total.toFixed(2)}</span>
      </div>
    `;
    
    resumoContainer.innerHTML = html;
    totalElement.textContent = total.toFixed(2);
  }

  // Mostra mensagem de sucesso
  mostrarMensagemSucesso() {
    const msg = document.getElementById('success-message');
    msg.style.display = 'block';
    setTimeout(() => {
      msg.style.display = 'none';
    }, 3000);
  }

// Finaliza pedido via WhatsApp E registra no sistema
finalizarPedido() {
    if (this.carrinho.length === 0) {
        alert('Seu carrinho est√° vazio!');
        return;
    }
    
    document.getElementById('loading').style.display = 'block';
    
    // Registrar pedido no sistema ANTES de enviar WhatsApp
    const clienteData = JSON.parse(sessionStorage.getItem('alphas_usuario') || 'null');
    
    // Salvar pedido usando localStorage para persistir entre p√°ginas
    const pedidos = JSON.parse(localStorage.getItem('alphas_pedidos') || '[]');
    const novoPedido = {
        id: Date.now(),
        cliente: clienteData ? clienteData.nome : 'Cliente An√¥nimo',
        itens: this.carrinho.map(item => `${item.produto} (${item.quantidade}x)`).join(', '),
        total: this.carrinho.reduce((sum, item) => sum + (item.preco * item.quantidade), 0),
        status: 'pendente',
        dataHora: new Date().toLocaleString('pt-BR'),
        detalhes: this.carrinho
    };
    
    pedidos.push(novoPedido);
    localStorage.setItem('alphas_pedidos', JSON.stringify(pedidos));
    
    // Notificar outras abas sobre o novo pedido
    const event = new CustomEvent('alphas_data_changed', {
        detail: { key: 'alphas_pedidos', value: JSON.stringify(pedidos) }
    });
    window.dispatchEvent(event);
    
    setTimeout(() => {
        let mensagem = 'üçî *PEDIDO ALPHA\'S BURGUES* üçî\n\n';
        let total = 0;
        let totalItens = 0;
        
        this.carrinho.forEach((item, index) => {
            const subtotal = item.preco * item.quantidade;
            total += subtotal;
            totalItens += item.quantidade;
            
            mensagem += `*${index + 1}.* ${item.produto}\n`;
            if (item.extras) mensagem += `   ${item.extras}\n`;
            mensagem += `   Qtd: ${item.quantidade}x | Valor: R$ ${subtotal.toFixed(2)}\n\n`;
        });
        
        mensagem += `‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n`;
        mensagem += `*RESUMO:*\n`;
        mensagem += `Total de itens: ${totalItens}\n`;
        mensagem += `*VALOR TOTAL: R$ ${total.toFixed(2)}*\n\n`;
        mensagem += `üìç Preciso confirmar endere√ßo para entrega\n`;
        mensagem += `üí≥ Forma de pagamento: (a combinar)\n\n`;
        mensagem += `Obrigado por escolher Alpha\'s Burgues! üéâ`;
        
        const numeroWhatsApp = '5582999999999';
        const whatsappURL = `https://wa.me/${numeroWhatsApp}?text=${encodeURIComponent(mensagem)}`;
        
        document.getElementById('loading').style.display = 'none';
        console.log(`Pedido #${novoPedido.id} registrado no sistema em tempo real!`);
        
        window.open(whatsappURL, '_blank');
    }, 1000);
}
}

// Inicializa o carrinho quando a p√°gina carrega
let carrinho;
window.onload = function() {
  carrinho = new CarrinhoManager();
};

// Fun√ß√µes globais para compatibilidade
function removerItem(id) {
  carrinho.removerItem(id);
}

function limparCarrinho() {
  carrinho.limparCarrinho();
}

function finalizarPedido() {
  carrinho.finalizarPedido();
}
// Fun√ß√£o para admin acessar dados de pedidos
function gerarRelatorio() {
    const dadosCarrinho = {
        timestamp: new Date().toISOString(),
        itens: carrinho,
        total: carrinho.reduce((sum, item) => sum + (item.preco * item.quantidade), 0)
    };
    
    console.log('Dados do pedido:', dadosCarrinho);
    return dadosCarrinho;
}
</script>

</body>
</html>